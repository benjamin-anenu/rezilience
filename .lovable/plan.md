

# Recent Events - Complete Audit

## Current Implementation

The **RECENT EVENTS** component (`src/components/program/RecentEvents.tsx`) currently derives events from the `score_history` table by comparing consecutive snapshots.

### Events Currently Tracked

| Event Type | Label | Icon | Trigger Logic |
|------------|-------|------|---------------|
| `score_update` | SCORE | Activity (teal) | Default when no significant change detected |
| `velocity_increase` | ACTIVE | ArrowUpCircle (teal) | When `commit_velocity` increases by more than 2 commits/week |
| `velocity_decrease` | SLOW | ArrowDownCircle (gray) | When `commit_velocity` decreases by more than 2 commits/week |
| `status_change` | STATUS | Shield (red) | When `score` changes by 5 or more points |

### Data Source

The events are **not** real GitHub events. They are **synthetic events** generated by comparing consecutive entries in `score_history`:

```typescript
const scoreDiff = entry.score - prevEntry.score;
const velocityDiff = (entry.commit_velocity ?? 0) - (prevEntry.commit_velocity ?? 0);
```

---

## What GitHub Events Are Available (Not Used in RECENT EVENTS)

Your edge function `analyze-github-repo` fetches up to 20 events from GitHub's Events API and stores them in `github_recent_events`:

| GitHub Event Type | Description | Currently Stored | Used in RECENT EVENTS |
|-------------------|-------------|------------------|----------------------|
| `PushEvent` | Commits pushed to branch/tag | Yes | No |
| `PullRequestEvent` | PR opened/closed/merged | Yes (counted in `pr_events_30d`) | No |
| `IssuesEvent` | Issue opened/closed | Yes (counted in `issue_events_30d`) | No |
| `IssueCommentEvent` | Comment on issue/PR | Yes (counted in `issue_events_30d`) | No |
| `ReleaseEvent` | New release published | Yes | No |
| `CreateEvent` | Branch/tag created | Yes | No |
| `DeleteEvent` | Branch/tag deleted | Yes | No |
| `ForkEvent` | Repository forked | Yes | No |
| `WatchEvent` | Repository starred | Yes | No |
| `MemberEvent` | Collaborator added | Yes | No |
| `PublicEvent` | Repo made public | Yes | No |

Sample stored data shows only `PushEvent` entries:
```json
[
  {"actor": "lovable-dev[bot]", "date": "2026-02-06T22:48:41Z", "type": "PushEvent"},
  {"actor": "lovable-dev[bot]", "date": "2026-02-06T22:33:02Z", "type": "PushEvent"}
]
```

---

## Gap Analysis

### What's Missing

1. **Real GitHub Events Not Displayed**
   - `github_recent_events` from the database contains actual GitHub activity (pushes, PRs, issues, releases) but the RECENT EVENTS card ignores this entirely
   - Users cannot see WHO pushed code, opened PRs, or created releases

2. **Missing Event Types for Protocol Health**
   - Release events (new version published)
   - Pull request events (merged/opened/closed)
   - Issue events (bugs reported, features requested)
   - Star events (community growth signals)
   - Fork events (ecosystem adoption)

3. **Limited Score-Based Events**
   - Only shows velocity and score changes
   - No visibility into liveness status transitions (ACTIVE -> STALE -> DECAYING)
   - No breakdown of why score changed

4. **No Historical Depth**
   - Only shows last 5 entries from `score_history`
   - No pagination or "load more" capability

---

## Proposed Enhancement

### New Event Types to Add

| Event Type | Label | Icon | Source |
|------------|-------|------|--------|
| `push` | PUSH | GitCommit | `github_recent_events` |
| `pull_request` | PR | GitPullRequest | `github_recent_events` |
| `issue` | ISSUE | CircleDot | `github_recent_events` |
| `release` | RELEASE | Package | `github_recent_events` |
| `star` | STAR | Star | `github_recent_events` |
| `fork` | FORK | GitFork | `github_recent_events` |
| `liveness_change` | STATUS | Shield | `score_history` (detect ACTIVE->STALE transitions) |
| `score_milestone` | MILESTONE | Trophy | When score crosses thresholds (50, 75, 90) |

### Implementation Approach

1. **Fetch GitHub Events**
   - Query `claimed_profiles.github_recent_events` alongside `score_history`
   - Merge real GitHub activity with score-derived events

2. **Unified Event Timeline**
   - Combine all event sources into a single chronological feed
   - Sort by date descending
   - Limit to 10-15 most recent

3. **Rich Event Rendering**
   - Show actor avatars for GitHub events
   - Include commit messages for push events
   - Link to PRs/issues on GitHub
   - Show release version tags

4. **Detect Status Transitions**
   - Compare `liveness_status` between score snapshots
   - Generate "Status changed from ACTIVE to STALE" events

### Technical Changes Required

| File | Change |
|------|--------|
| `src/components/program/RecentEvents.tsx` | Accept `githubEvents` prop, merge with score-derived events |
| `src/pages/ProgramDetail.tsx` | Pass `github_recent_events` to `RecentEvents` component |
| `src/types/database.ts` | Add types for GitHub event objects |
| Edge function | Already captures events, no change needed |

